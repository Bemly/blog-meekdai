最近在写 TUI terminal UI界面，需要用到

鼠标来控制坐标，索性了解来一下 ANSI 的用法

下面是原作者写的 Gist，个人觉得已经非常详细了，遂即把这个翻译出来给大家分享分享：

{% gist 458719343aabd01cfb17a3a4f7296797 %}

<script src="https://gist.github.com/fnky/458719343aabd01cfb17a3a4f7296797.js"></script>

翻译稿：

{% gist 25b4391d1c34c5e3d1fbb238634570b2 %}

<script src="https://gist.github.com/Bemly/25b4391d1c34c5e3d1fbb238634570b2.js"></script>

# ANSI 转义标识符

标准转义码的前缀是 `Escape` 脱离键，常用名`ESC键`:

- Ctrl 键: `^[`
- 八进制: `\033`
- Unicode编码: `\u001b`
- 16进制: `\x1B`
- 十进制: `27`

ESC 后面跟命令，用左方括号（`[`）分隔，一同称为控制标识符导入器（CSI），\
CSI 后面还可以跟参数和命令本身。

参数用分号（`;`）分割。

例如：

```sh
\x1b[1;31m  # 1代表加粗，31代表红色前景色（也就是字体颜色）
```

## 标识符（序列）

- `ESC` - 标准转义码最开始的标识符 `ESC` (`\x1B`)
- `CSI` - 控制标识符引入器： `ESC [` 或 CSI (`\x9B`) 开头
- `DCS` - 设备控制字符串： `ESC P` 或 DCS (`\x90`) 开头
- `OSC` - 操作系统命令： `ESC ]` 或 OSC (`\x9D`) 开头

忽略掉 标识符 和参数之间的所有空格。它们的存在是为了提高可读性。

## 通用 ASCII 码

| 标识符 | 十进制   | 8进制  |16进制| 转义符    | Ctrl+键   | 说明                       |
| ----- | ------- | ----- | ---- | -------- | -------- | ---------------------------|
| `BEL` | 7       | 007   | 0x07 | `\a`     | `^G`     | BIOS 蜂鸣器 终端响声         |
| `BS`  | 8       | 010   | 0x08 | `\b`     | `^H`     | 退格键                      |
| `HT`  | 9       | 011   | 0x09 | `\t`     | `^I`     | 横向 TAB 制表符              |
| `LF`  | 10      | 012   | 0x0A | `\n`     | `^J`     | 行种子 (换行)                |
| `VT`  | 11      | 013   | 0x0B | `\v`     | `^K`     | 垂直 TAB 制表符              |
| `FF`  | 12      | 014   | 0x0C | `\f`     | `^L`     | 表格种子 (同理: 新建页面 `NP`) |
| `CR`  | 13      | 015   | 0x0D | `\r`     | `^M`     | 回车                        |
| `ESC` | 27      | 033   | 0x1B | `\e`[*](#escape) | `^[` | ESC 字符                |
| `DEL` | 127     | 177   | 0x7F | `<none>` | `<none>` | 删除字符                     |

<div id="escape"></div>

> **注意：** 某些控制转义标识符，例如 `ESC` 的 `\e`, 不能保证在所有语言和编译器中工作。建议用进制作为转义码。

> **注意：** **Ctrl+键** 表示只是将 ASCII码1 中不可打印字符与 ASCII码65（`A`）中的可打印字符相关联。
ASCII码1是`^A`（Ctrl-A），而 ASCII 码 7（BEL）是`^G`（Ctrl-G）。

## 终端光标控制

下表的 `#` 代表不限位数的任意数字

| ESC 码标识符                                        | 说明                              |
| :------------------------------------------------- | :--------------------------------|
| `ESC[H`                                            | 光标回到左上角 Home 位置 (0, 0)     |
| `ESC[{行};{列}H` <br> `ESC[{行};{列}f`              | 光标跳转到 # 行, # 列               |
| `ESC[#A`                                           | 光标向上移动 # 行                   |
| `ESC[#B`                                           | 光标向下移动 # 行                   |
| `ESC[#C`                                           | 光标向右移动 # 列                   |
| `ESC[#D`                                           | 光标向左移动 # 列                   |
| `ESC[#E`                                           | 光标向下移动 # 行，并移动到行首       |
| `ESC[#F`                                           | 光标向上移动 # 行，并移动到行首       |
| `ESC[#G`                                           | 光标跳转到 # 列                    |
| `ESC[6n`                                           | 获取光标行列坐标 (打印出 `ESC[#;#R`) |
| `ESC M`                                            | 向上移动一行，如上方遮挡可以滚动一行   |
| `ESC 7`                                            | 缓存光标坐标 (DEC)                 |
| `ESC 8`                                            | 恢复最后一次缓存的光标坐标 (DEC)     |
| `ESC[s`                                            | 缓存光标坐标 (SCO)                 |
| `ESC[u`                                            | 恢复最后一次缓存的光标坐标 (SCO)     |

> **注意：** 某些标识符（如恢复和恢复光标）是私有标识符，没有标准化。
虽然一些终端仿真器（即xterm及其派生终端）支持 `SCO` 和 `DEC` 标识符，
但它们都可能具有不同功能。因此，更建议使用 `DEC` 标识符。



## 清除功能

| ESC 码标识符       | 说明                                  |
| :---------------- | :----------------------------------- |
| `ESC[J`           | 从光标位置正向清除到右下角（默认为0）      |
| `ESC[0J`          | 从光标位置正向清除到右下角               |
| `ESC[1J`          | 从光标位置反向清除到左上角               |
| `ESC[2J`          | 清屏                                 |
| `ESC[3J`          | 清除所有行，包括屏幕外缓存着的、可供滚动的 |
| `ESC[K`           | 从光标位置正向清除到行尾（默认为0）       |
| `ESC[0K`          | 从光标位置正向清除到行尾                |
| `ESC[1K`          | 从光标位置反向清除到行首                |
| `ESC[2K`          | 清除光标所在整行                       |

> 注意：清行之后光标固定，即光标将停留在该行被删除之前的位置。
您可以选择在清行后使用 `\r` 将光标返回到当前行首。


## 颜色 显示模式

| ESC 码标识符        | 重置为默认标识符 | 说明                            |
| :---------------- | :------------- | :----------------------------- |
| `ESC[1;34;{...}m` |                | 设置单元格显示模式，用 (`;`) 分隔。 |
| `ESC[0m`          |                | 重置所有效果 (样式 和 颜色)        |
| `ESC[1m`          | `ESC[22m`      | 加粗                            |
| `ESC[2m`          | `ESC[22m`      | 变暗变模糊                       |
| `ESC[3m`          | `ESC[23m`      | 斜体                            |
| `ESC[4m`          | `ESC[24m`      | 下划线                          |
| `ESC[5m`          | `ESC[25m`      | 闪烁                            |
| `ESC[7m`          | `ESC[27m`      | 设置反向/反转模式                 |
| `ESC[8m`          | `ESC[28m`      | 设置隐藏/不可见模式                |
| `ESC[9m`          | `ESC[29m`      | 删除线                           |

> **注意:** 有些终端可能不支持上面的标识符操作。

> **注意:** `ESC[1m` 和 `ESC[2m` 都可以用 `ESC[22m` 标识符重置。 
`ESC[21m` 标识符 是双下划线模式的 **非标准** 标识符，仅在某些终端中工作，并使用 `ESC[24m` 重置。

### 颜色代码

大多数终端支持8色和16色，以及256（8位）色。这些颜色由用户设置，但具有通常定义的含义。\
`tty` 一般只有8色，而 `pts` 一般有 256 色。

#### 8-16 色

| 色    | 字体颜色               | 背景色                 |
| :--- | :-------------------- | :-------------------- |
| 黑   | `30`                  | `40`                  |
| 红   | `31`                  | `41`                  |
| 绿   | `32`                  | `42`                  |
| 黄   | `33`                  | `43`                  |
| 蓝   | `34`                  | `44`                  |
| 粉   | `35`                  | `45`                  |
| 青   | `36`                  | `46`                  |
| 白   | `37`                  | `47`                  |
| 默认 | `39`                  | `49`                  |
| 重置 | `0`                   | `0`                   |

> **注意：** _重置_ 颜色 指：重置所有 _颜色_ 和文本效果，使用 _默认_ 颜色指：仅重置颜色。

除了基本的8种颜色外，大多数终端还支持 `bright` 或 `bold` 的颜色。
如下例子：
`1;` 表示 `bright`，`2;` 表示 `bold`，

```sh
# 加粗，红色
\x1b[1;31mHello
# 变暗，白色，红背景
\x1b[2;37;41mWorld
```

一些终端支持 
[aixterm 规范](https://sites.ualberta.ca/dept/chemeng/AIX-43/share/man/info/C/a_doc_lib/cmds/aixcmds1/aixterm.htm)。
提供一些 不需要写加粗符 的 ISO 颜色的明亮版本：

| 色     | 字体颜色               | 背景色                 |
| :---- | :-------------------- | :-------------------- |
| 粗黑   | `90`                  | `100`                 |
| 粗红   | `91`                  | `101`                 |
| 粗绿   | `92`                  | `102`                 |
| 粗黄   | `93`                  | `103`                 |
| 粗蓝   | `94`                  | `104`                 |
| 粗粉   | `95`                  | `105`                 |
| 粗青   | `96`                  | `106`                 |
| 粗白   | `97`                  | `107`                 |

#### 256 色

| ESC 码标识符      | 说明        |
| :--------------- | :--------- |
| `ESC[38;5;{ID}m` | 设置字体颜色 |
| `ESC[48;5;{ID}m` | 设置背景色   |

自己对照着下图的 `{ID}` 来写从 0-255 的颜色表：

![256 Color table](https://user-images.githubusercontent.com/995050/47952855-ecb12480-df75-11e8-89d4-ac26c50e80b9.png)

从上面提到的 16基础色（0-15） 开始。\
将 216种颜色（16-231） / 3bpc RGB值 偏移 16 ，包装为单个色值。\
最后 24种颜色（232-255） 为灰度值，从深到浅\
一些终端仿真器将这些步长解释为所有三个通道上的线性增量（256 / 24）。

#### RGB 色

现代终端都支持 [真彩色](https://en.wikipedia.org/wiki/Color_depth#True_color_.2824-bit.29) (24位 RGB)。


| ESC 码标识符             | 说明             |
| :---------------------- | :-------------- |
| `ESC[38;2;{r};{g};{b}m` | 设置 RGB 字体颜色 |
| `ESC[48;2;{r};{g};{b}m` | 设置 RGB 背景色   |

> **注意：** `;38` 和 `;48` 对应于 16色 的冗余标识符，并由终端解释以分别设置前景和背景色。其中 `;2` 和 `;5` 作为设置颜色格式。

![image](https://github.com/user-attachments/assets/8382efab-b552-4d53-ae83-2a381cd62782)


## 屏幕功能

### 设置显示模式

        TODO: 还没搞懂，之后再翻译补充

| ESC 码标识符 | 说明                                                                                                                                                           |
| :---------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ESC[={值}h`   | Changes the screen width or type to the mode specified by value.                                                                                                      |
| `ESC[=0h`         | 40 x 25 monochrome (text)                                                                                                                                             |
| `ESC[=1h`         | 40 x 25 color (text)                                                                                                                                                  |
| `ESC[=2h`         | 80 x 25 monochrome (text)                                                                                                                                             |
| `ESC[=3h`         | 80 x 25 color (text)                                                                                                                                                  |
| `ESC[=4h`         | 320 x 200 4-color (graphics)                                                                                                                                          |
| `ESC[=5h`         | 320 x 200 monochrome (graphics)                                                                                                                                       |
| `ESC[=6h`         | 640 x 200 monochrome (graphics)                                                                                                                                       |
| `ESC[=7h`         | Enables line wrapping                                                                                                                                                 |
| `ESC[=13h`        | 320 x 200 color (graphics)                                                                                                                                            |
| `ESC[=14h`        | 640 x 200 color (16-color graphics)                                                                                                                                   |
| `ESC[=15h`        | 640 x 350 monochrome (2-color graphics)                                                                                                                               |
| `ESC[=16h`        | 640 x 350 color (16-color graphics)                                                                                                                                   |
| `ESC[=17h`        | 640 x 480 monochrome (2-color graphics)                                                                                                                               |
| `ESC[=18h`        | 640 x 480 color (16-color graphics)                                                                                                                                   |
| `ESC[=19h`        | 320 x 200 color (256-color graphics)                                                                                                                                  |
| `ESC[={值}l`   | Resets the mode by using the same values that Set Mode uses, except for 7, which disables line wrapping. The last character in this escape sequence is a lowercase L. |

### 非标准 通用 功能

这些是 私有模式 的一些示例，它们没有在 **规范** 中定义，但在大多数终端中实现。

| ESC 码标识符 | 说明                     |
| :---------------- | :---------------- |
| `ESC[?25l`        | 隐藏光标           |
| `ESC[?25h`        | 显示光标           |
| `ESC[?47l`        | 恢复上一次保存的屏幕 |
| `ESC[?47h`        | 保存屏幕           |
| `ESC[?1049h`      | 启用备用缓冲区      |
| `ESC[?1049l`      | 关闭备用缓冲区      |

有关XTerm定义的私有模式的更详细列表，请参阅：[XTerm 控制标识符](https://invisible-island.net/xterm/ctlseqs/ctlseqs.html)。

> **注意: ** 虽然大多数终端可能支持这些模式，但有些模式可能不适用于 `tmux` 等多路复用器。

### 键盘码对应的字符串

```sh
ESC[{code};{string};{...}p
```

将键盘键重新定义为指定的字符串。\
此转义标识符的参数定义如下：

- `code` ：下表中列出的一个或多个值，一般为键盘键或组合键。
在命令中使用这些值时，除了 转义标识符 所需的 通配符 外，还必须键入下表中显示的 通配符 。
括号中的代码在 **某些键盘** 上不可用。
除非您在 `ANSI.SYS` 的 `DEVICE` 命令中指定 `/X` 开关，否则 `ANSI.SYS` 不会解释这些键盘的括号中的代码。

- `string` ：是单个字符或包含在引号中的字符串的 ASCII 代码。例如，65和 "A" 都可以用来表示一个 `A` 。

> **重要说明：** 下表中的某些值并非对所有计算机都有效。最终解释交给你的计算机处理。   ：）

#### 键盘码对应的字符串列表

| 键                       | CSI 码    | SHIFT+CSI码| CTRL+CSI码| ALT+CSI码  |
| ------------------------ | -------- | ---------- | --------- | --------- |
| F1                       | 0;59     | 0;84       | 0;94      | 0;104     |
| F2                       | 0;60     | 0;85       | 0;95      | 0;105     |
| F3                       | 0;61     | 0;86       | 0;96      | 0;106     |
| F4                       | 0;62     | 0;87       | 0;97      | 0;107     |
| F5                       | 0;63     | 0;88       | 0;98      | 0;108     |
| F6                       | 0;64     | 0;89       | 0;99      | 0;109     |
| F7                       | 0;65     | 0;90       | 0;100     | 0;110     |
| F8                       | 0;66     | 0;91       | 0;101     | 0;111     |
| F9                       | 0;67     | 0;92       | 0;102     | 0;112     |
| F10                      | 0;68     | 0;93       | 0;103     | 0;113     |
| F11                      | 0;133    | 0;135      | 0;137     | 0;139     |
| F12                      | 0;134    | 0;136      | 0;138     | 0;140     |
| HOME (数字键盘部分)        | 0;71     | 55         | 0;119     | \--       |
| UP ARROW (数字键盘部分)    | 0;72     | 56         | (0;141)   | \--       |
| PAGE UP (数字键盘部分)     | 0;73     | 57         | 0;132     | \--       |
| LEFT ARROW (数字键盘部分)  | 0;75     | 52         | 0;115     | \--       |
| RIGHT ARROW (数字键盘部分) | 0;77     | 54         | 0;116     | \--       |
| END (数字键盘部分)         | 0;79     | 49         | 0;117     | \--       |
| DOWN ARROW (数字键盘部分)  | 0;80     | 50         | (0;145)   | \--       |
| PAGE DOWN (数字键盘部分)   | 0;81     | 51         | 0;118     | \--       |
| INSERT (数字键盘部分)      | 0;82     | 48         | (0;146)   | \--       |
| DELETE (数字键盘部分)      | 0;83     | 46         | (0;147)   | \--       |
| HOME                     | (224;71) | (224;71)   | (224;119) | (224;151) |
| UP ARROW                 | (224;72) | (224;72)   | (224;141) | (224;152) |
| PAGE UP                  | (224;73) | (224;73)   | (224;132) | (224;153) |
| LEFT ARROW               | (224;75) | (224;75)   | (224;115) | (224;155) |
| RIGHT ARROW              | (224;77) | (224;77)   | (224;116) | (224;157) |
| END                      | (224;79) | (224;79)   | (224;117) | (224;159) |
| DOWN ARROW               | (224;80) | (224;80)   | (224;145) | (224;154) |
| PAGE DOWN                | (224;81) | (224;81)   | (224;118) | (224;161) |
| INSERT                   | (224;82) | (224;82)   | (224;146) | (224;162) |
| DELETE                   | (224;83) | (224;83)   | (224;147) | (224;163) |
| PRINT SCREEN             | \--      | \--        | 0;114     | \--       |
| PAUSE/BREAK              | \--      | \--        | 0;0       | \--       |
| BACKSPACE                | 8        | 8          | 127       | (0)       |
| ENTER                    | 13       | \--        | 10        | (0        |
| TAB                      | 9        | 0;15       | (0;148)   | (0;165)   |
| NULL                     | 0;3      | \--        | \--       | \--       |
| A                        | 97       | 65         | 1         | 0;30      |
| B                        | 98       | 66         | 2         | 0;48      |
| C                        | 99       | 66         | 3         | 0;46      |
| D                        | 100      | 68         | 4         | 0;32      |
| E                        | 101      | 69         | 5         | 0;18      |
| F                        | 102      | 70         | 6         | 0;33      |
| G                        | 103      | 71         | 7         | 0;34      |
| H                        | 104      | 72         | 8         | 0;35      |
| I                        | 105      | 73         | 9         | 0;23      |
| J                        | 106      | 74         | 10        | 0;36      |
| K                        | 107      | 75         | 11        | 0;37      |
| L                        | 108      | 76         | 12        | 0;38      |
| M                        | 109      | 77         | 13        | 0;50      |
| N                        | 110      | 78         | 14        | 0;49      |
| O                        | 111      | 79         | 15        | 0;24      |
| P                        | 112      | 80         | 16        | 0;25      |
| Q                        | 113      | 81         | 17        | 0;16      |
| R                        | 114      | 82         | 18        | 0;19      |
| S                        | 115      | 83         | 19        | 0;31      |
| T                        | 116      | 84         | 20        | 0;20      |
| U                        | 117      | 85         | 21        | 0;22      |
| V                        | 118      | 86         | 22        | 0;47      |
| W                        | 119      | 87         | 23        | 0;17      |
| X                        | 120      | 88         | 24        | 0;45      |
| Y                        | 121      | 89         | 25        | 0;21      |
| Z                        | 122      | 90         | 26        | 0;44      |
| 1                        | 49       | 33         | \--       | 0;120     |
| 2                        | 50       | 64         | 0         | 0;121     |
| 3                        | 51       | 35         | \--       | 0;122     |
| 4                        | 52       | 36         | \--       | 0;123     |
| 5                        | 53       | 37         | \--       | 0;124     |
| 6                        | 54       | 94         | 30        | 0;125     |
| 7                        | 55       | 38         | \--       | 0;126     |
| 8                        | 56       | 42         | \--       | 0;126     |
| 9                        | 57       | 40         | \--       | 0;127     |
| 0                        | 48       | 41         | \--       | 0;129     |
| \-                       | 45       | 95         | 31        | 0;130     |
| \=                       | 61       | 43         | \---      | 0;131     |
| \[                       | 91       | 123        | 27        | 0;26      |
| \]                       | 93       | 125        | 29        | 0;27      |
|                          | 92       | 124        | 28        | 0;43      |
| ;                        | 59       | 58         | \--       | 0;39      |
| '                        | 39       | 34         | \--       | 0;40      |
| ,                        | 44       | 60         | \--       | 0;51      |
| .                        | 46       | 62         | \--       | 0;52      |
| /                        | 47       | 63         | \--       | 0;53      |
| \`                       | 96       | 126        | \--       | (0;41)    |
| ENTER (额外键盘部分)       | 13       | \--        | 10        | (0;166)   |
| / (额外键盘部分)           | 47       | 47         | (0;142)   | (0;74)    |
| \* (额外键盘部分)          | 42       | (0;144)    | (0;78)    | \--       |
| \- (额外键盘部分)          | 45       | 45         | (0;149)   | (0;164)   |
| \+ (额外键盘部分)          | 43       | 43         | (0;150)   | (0;55)    |
| 5 (额外键盘部分)           | (0;76)   | 53         | (0;143)   | \--       |

## 鸣谢

- [Wikipedia: ANSI escape code](https://en.wikipedia.org/wiki/ANSI_escape_code)
- [Build your own Command Line with ANSI escape codes](http://www.lihaoyi.com/post/BuildyourownCommandLinewithANSIescapecodes.html)
- [ascii-table: ANSI Escape sequences](http://ascii-table.com/ansi-escape-sequences.php)
- [bluesock: ansi codes](https://bluesock.org/~willkg/dev/ansi.html)
- [bash-hackers: Terminal Codes (ANSI/VT100) introduction](http://wiki.bash-hackers.org/scripting/terminalcodes)
- [XTerm Control Sequences](https://invisible-island.net/xterm/ctlseqs/ctlseqs.html)
- [VT100 – Various terminal manuals](https://vt100.net/)
- [xterm.js – Supported Terminal Sequences](https://xtermjs.org/docs/api/vtfeatures/)
